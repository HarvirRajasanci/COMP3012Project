<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.classless.min.css"
    />
    <link href="/css/style.css" rel="stylesheet" />
    <title>Post</title>
  </head>
  <body>
    <main>
      <div class="authOptions">
        <h1>View Post</h1>
        <a role="button" href="/posts">Home</a>
      </div>
      <div>
        <p> <%= post.title %></p>
        <p> Creator: <%= post.creator.uname %></p>
        <p> <a href="post.link"><%= post.link %></a></p>

        <div id="vote">
          <p>Votes: <%= post.votes.reduce((acc, vote) => acc + vote.value, 0) %></p>
          <% if (user) { %>
            <form method="post" action="/posts/vote/<%= post.id %>" id="vote-form">
              <button type="submit" name="setvoteto" value="1" class="vote-up <% if (post.user_vote === 1) { %>active<% } %>">+</button>
              <button type="submit" name="setvoteto" value="-1" class="vote-down <% if (post.user_vote === -1) { %>active<% } %>">-</button>
            </form>
          <% } %>
        </div>

        <p> <%= post.timestamp %></p>
        <% if (user) { %>
          <% if (user.id === post.creator.id) { %>
          <a role="button" href="/posts/edit/<%=post.id%>">Edit Post</a>
          <a role="button" href="/posts/deleteconfirm/<%=post.id%>">Delete Post</a><br><br>
        <%  } %>
        <% } %>

        <p><Strong> Comments: </Strong></p>
        <% comments.forEach((comment) => { %>
          <div class="comment">
            <p><%= comment.description %></p>
            <p>By: <%= comment.creator.id %></p>
            <p>Posted: <%= comment.timestamp %></p>

            <% if (user) { %>
            <% if (user.id === comment.creator.id || user.id === post.creator.id) { %>
              <a role="button" href="">Delete Comment</a>
            <%  } %>
            <% } %>
          </div><br>
        <% }) %>

        <% if (user) { %>
          <br>
          <form action="/posts/comment-create/<%=post.id%>" method="post">
            <input type="text" placeholder="description" name="description">
            <button>Post Comment</button>
          </form>
        <% } %>

      </div>
    </main>
  </body>
</html>
